1
- https://aghedupl-my.sharepoint.com/personal/mslaz_agh_edu_pl/_layouts/15/stream.aspx?id=%2Fpersonal%2Fmslaz%5Fagh%5Fedu%5Fpl%2FDocuments%2FConstraint%20Programming%2FCP%5F2025%5Flecture%5F01%2Emp4&nav=eyJyZWZlcnJhbEluZm8iOnsicmVmZXJyYWxBcHAiOiJPbmVEcml2ZUZvckJ1c2luZXNzIiwicmVmZXJyYWxBcHBQbGF0Zm9ybSI6IldlYiIsInJlZmVycmFsTW9kZSI6InZpZXciLCJyZWZlcnJhbFZpZXciOiJNeUZpbGVzTGlua0NvcHkifX0&referrer=StreamWebApp%2EWeb&referrerScenario=AddressBarCopied%2Eview%2E7133c2c1%2Db557%2D4930%2Dbaad%2Dd7cae8615f59&ga=1
- (Better) https://aghedupl-my.sharepoint.com/personal/mslaz_agh_edu_pl/_layouts/15/stream.aspx?id=%2Fpersonal%2Fmslaz_agh_edu_pl%2FDocuments%2FConstraint+Programming%2FCP_lecture_02.avi&nav=eyJyZWZlcnJhbEluZm8iOnsicmVmZXJyYWxBcHAiOiJTdHJlYW1XZWJBcHAiLCJyZWZlcnJhbFZpZXciOiJTaGFyZURpYWxvZy1MaW5rIiwicmVmZXJyYWxBcHBQbGF0Zm9ybSI6IldlYiIsInJlZmVycmFsTW9kZSI6InZpZXcifX0%3D&referrer=StreamWebApp.Web&referrerScenario=AddressBarCopied.view.f264caf9-d4e2-4c5b-a877-5231de172e38&ga=1&startedResponseCatch=true

2
- https://aghedupl-my.sharepoint.com/personal/mslaz_agh_edu_pl/_layouts/15/stream.aspx?id=%2Fpersonal%2Fmslaz%5Fagh%5Fedu%5Fpl%2FDocuments%2FConstraint%20Programming%2FCP%5F2025%5Flecture%5F02%2Emp4&nav=eyJyZWZlcnJhbEluZm8iOnsicmVmZXJyYWxBcHAiOiJPbmVEcml2ZUZvckJ1c2luZXNzIiwicmVmZXJyYWxBcHBQbGF0Zm9ybSI6IldlYiIsInJlZmVycmFsTW9kZSI6InZpZXciLCJyZWZlcnJhbFZpZXciOiJNeUZpbGVzTGlua0NvcHkifX0&referrer=StreamWebApp%2EWeb&referrerScenario=AddressBarCopied%2Eview%2Eb067292a%2D6542%2D47e0%2D881d%2Dc8bfe267b7bf&ga=1
- https://aghedupl-my.sharepoint.com/personal/mslaz_agh_edu_pl/_layouts/15/stream.aspx?id=%2Fpersonal%2Fmslaz_agh_edu_pl%2FDocuments%2FConstraint+Programming%2FCP_lecture_03.mp4&nav=eyJyZWZlcnJhbEluZm8iOnsicmVmZXJyYWxBcHAiOiJPbmVEcml2ZUZvckJ1c2luZXNzIiwicmVmZXJyYWxBcHBQbGF0Zm9ybSI6IldlYiIsInJlZmVycmFsTW9kZSI6InZpZXciLCJyZWZlcnJhbFZpZXciOiJNeUZpbGVzTGlua0NvcHkifX0&referrer=StreamWebApp.Web&referrerScenario=AddressBarCopied.view.5c8c21b1-9093-4963-b243-f8fc2d6f1083&ga=1&startedResponseCatch=true

3
- https://aghedupl-my.sharepoint.com/personal/mslaz_agh_edu_pl/_layouts/15/stream.aspx?id=%2Fpersonal%2Fmslaz%5Fagh%5Fedu%5Fpl%2FDocuments%2FConstraint%20Programming%2FCP%5F2025%5Flecture%5F03%2Emp4&nav=eyJyZWZlcnJhbEluZm8iOnsicmVmZXJyYWxBcHAiOiJPbmVEcml2ZUZvckJ1c2luZXNzIiwicmVmZXJyYWxBcHBQbGF0Zm9ybSI6IldlYiIsInJlZmVycmFsTW9kZSI6InZpZXciLCJyZWZlcnJhbFZpZXciOiJNeUZpbGVzTGlua0NvcHkifX0&referrer=StreamWebApp%2EWeb&referrerScenario=AddressBarCopied%2Eview%2E84796164%2D7eb8%2D4ab0%2Da2be%2D7bbdb98c6865
- https://aghedupl-my.sharepoint.com/personal/mslaz_agh_edu_pl/_layouts/15/stream.aspx?id=%2Fpersonal%2Fmslaz_agh_edu_pl%2FDocuments%2FConstraint+Programming%2FCP_Projects.mp4&nav=eyJyZWZlcnJhbEluZm8iOnsicmVmZXJyYWxBcHAiOiJPbmVEcml2ZUZvckJ1c2luZXNzIiwicmVmZXJyYWxBcHBQbGF0Zm9ybSI6IldlYiIsInJlZmVycmFsTW9kZSI6InZpZXciLCJyZWZlcnJhbFZpZXciOiJNeUZpbGVzTGlua0NvcHkifX0&referrer=StreamWebApp.Web&referrerScenario=AddressBarCopied.view.a8eb6c56-fb32-4431-870c-68544fac1c06&ga=1&startedResponseCatch=true

4
- https://aghedupl-my.sharepoint.com/personal/mslaz_agh_edu_pl/_layouts/15/stream.aspx?id=%2Fpersonal%2Fmslaz%5Fagh%5Fedu%5Fpl%2FDocuments%2FConstraint%20Programming%2FCP%5F2025%5Flecture%5F04%2Emp4&nav=eyJyZWZlcnJhbEluZm8iOnsicmVmZXJyYWxBcHAiOiJPbmVEcml2ZUZvckJ1c2luZXNzIiwicmVmZXJyYWxBcHBQbGF0Zm9ybSI6IldlYiIsInJlZmVycmFsTW9kZSI6InZpZXciLCJyZWZlcnJhbFZpZXciOiJNeUZpbGVzTGlua0NvcHkifX0&referrer=StreamWebApp%2EWeb&referrerScenario=AddressBarCopied%2Eview%2E4819bd92%2D1830%2D42e5%2D903f%2Dd9189e6abfc3&ga=1
- https://aghedupl-my.sharepoint.com/personal/mslaz_agh_edu_pl/_layouts/15/stream.aspx?id=%2Fpersonal%2Fmslaz_agh_edu_pl%2FDocuments%2FConstraint+Programming%2FCP_2025_lecture_05.mp4&nav=eyJyZWZlcnJhbEluZm8iOnsicmVmZXJyYWxBcHAiOiJPbmVEcml2ZUZvckJ1c2luZXNzIiwicmVmZXJyYWxBcHBQbGF0Zm9ybSI6IldlYiIsInJlZmVycmFsTW9kZSI6InZpZXciLCJyZWZlcnJhbFZpZXciOiJNeUZpbGVzTGlua0NvcHkifX0&referrer=StreamWebApp.Web&referrerScenario=AddressBarCopied.view.9d887246-52ff-4ea2-8134-a5c9a92971a2&ga=1&startedResponseCatch=true


Jakub Halfar - jakiś dojebany ziomek z niższych roczników, co dużo ogarnia
Opis projektu Enroll
`alter-table-scoreboard-drop-all-constraints` strategy

Firstly, we created a MiniZinc model for the problem. The model had a quadratic objective (which by the definition of the problem cannot be reduced to a linear one) and all of the constraints were linear except three:
- `day_start` and `day_end` calculation. The problematic part is that we need to take the `min` and `max` of each attended group for every student and every day, but only in the case that there is a nonzero number of groups that day. `min([])` and `max([])` is undefined, so we need to take extra care by setting `day_start = day_end = 0` for days where there are no classes for that student, so that `time_spent = day_end - day_start = 0`. Our first implementation used a conditional expression to handle this.
- `max(0, time_spent - total_class_time)` used in break disappointment to make it non-negative.
- `ceil_div` logic. This function appears in the calculations of the two different disappointments and is nonlinear.

We originally ran the model on the OR-Tools solver, but it got stuck around ~38000. Thus, we made several improvements:
- we changed the solver to Gurobi and ran it via MiniZinc with max threads possible and printing the intermediary solutions
- we optimized the model further: linearized the `min` and `max` constraints using tight "big M" values (`max(group_start)` and `max(group_end)`) and used helper variable `has_classes`, which indicates if the student has classes that day. We also used a 3D matrix (`n_students` x `n_days` x `n_groups`) of boolean indicator variables that mock the `min` and `max` functions in a linear way. This linearization gave a massive performance boost.
- we linearized the `max` used the in the break disappointment constraint.

We ran the model by using the MiniZinc's `warm_start` attribute, starting the search near the last best solution. By running the model for about 1.5 days straight, it found a solution of `35638`. It then got stuck for 12 hours, and unfortunately when I checked the computer screen in the morning, there was a Windows login screen instead of the terminal window :( I don't know exactly what happened, but it could been a Windows update / power outage / BSOD etc. and I unfortunaley lost the current search tree progress.

Despite many days left until the competition deadline, I couldn't manage to make the solver find a better solution. What I have tried:
- I have rewritten the model natively in `gurobipy` and tried to run it with different flags like `MIPFocus`, `Presolve`, increasing max RAM size before writing to the disk etc.
- I have tried to solve a relaxed version of the model (linear objective, all constraints linear and continuous variables for the division, not discrete), hoping to quickly find good solutions which by chance could be better in the original model when remapped. Despite the relaxed model calculating rapidly, the solutions were far off the minimal solution found.
- I have tried to linearize the `ceil_div` in MiniZinc using two constraints bounding the quotient value, but it was very slow and needed very tight bounds, which were hard to estimate. It seems that the MiniZinc compiler did a good job optimizing the original nonlinear constraint.
- I have tried to linearize the `ceil_div` in `gurobipy`, which was necessary, because the library doesn't support a ceiling function natively. I have tried using PWL (piecewise linear functions), but the performance was terrible. The two linear constraints approach was the best and this time the loose bounds worked quite well.
- I relaxed the `day_start` and `day_end` constraints to only make `day_start <= all of the attended groups` and `day_end >= all of the attended groups`, making the solver set `day_start = earliest attended group` and `day_end = latest attended group` via minimizing the objective (mizimizing `day_start - day_end` indirectly by minimizing break disappointment). The case of no classes that day was handled via an indicator constraint (this time a 2D matrix).
- I have tried reducing the variable domains by calculating the time units GCD and dividing everything by that. Despite improvements in other datasets (changing 5 min resolution to 15 min), in the `competition.dzn` the largest possible was 5 min.
- I have tried dividing the whole day into non-overlapping slots, but the problem was that there were some groups with their start times differing by only 5 min (e.g. 14:40 and 14:45).
- I have tried implementing a Large Neighbourhood Search with different destroy operators and Simulated Annealing, but it didn't improve the solution
- when none of the above worked, as a last resort I bought a Google VM for fun with 32 vCPUs and 128 GB RAM for about ~70 PLN and ran it for 24 hours. Unfortunately, it did not find a better solution :(

Finally, the solved narrowed the gap to: `34536 <= optimum <= 35638`

TLDR:
- we ran Gurobi solver via MiniZinc with max threads possible
- we linearized the `min` and `max` used in `day_start` and `day_end` using Big M values and handling the case with no classes that day separately
- we linearized the `max` inside the break disappointment calculation
- we kept the `ceil_div` in both cases
- we represented the problem as a `n_students` x `n_groups` boolean matrix `group_assignment`
- we did not use any obvious redundant constraints (maybe except setting explicitly that the `day_start` and `day_end` must be the earliest and latest group in the previous version and letting the solver figure that out by minimization in the final version)
- we did not use any symmetry breaking constraints (there were no students in the dataset which had the same preferences)
- we did not use any global constraints
- we did not normalize the data in any way (there wasn't any obvious way to do so)